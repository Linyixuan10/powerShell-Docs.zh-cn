---
ms.date: 08/23/2017
keywords: powershell,cmdlet
title: 安装和使用 Windows PowerShell Web 访问
ms.openlocfilehash: a3207c859c4b93b07d4c1b41d7df5269daa39a7d
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/22/2020
ms.locfileid: "79402614"
---
# <a name="install-and-use-windows-powershell-web-access"></a><span data-ttu-id="eda78-103">安装和使用 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-103">Install and Use Windows PowerShell Web Access</span></span>

<span data-ttu-id="eda78-104">更新时间：2013 年 11 月 5 日（编辑：2017 年 8 月 23 日）</span><span class="sxs-lookup"><span data-stu-id="eda78-104">Updated: November 5, 2013 (Edited: August 23, 2017)</span></span>

<span data-ttu-id="eda78-105">适用于：Windows Server 2012 R2、Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="eda78-105">Applies To: Windows Server 2012 R2, Windows Server 2012</span></span>

## <a name="introduction"></a><span data-ttu-id="eda78-106">简介</span><span class="sxs-lookup"><span data-stu-id="eda78-106">Introduction</span></span>

<span data-ttu-id="eda78-107">Windows PowerShell Web 访问在 Windows Server 2012 中首次引入，充当 Windows PowerShell 网关，提供以远程计算机为目标的基于 Web 的 Windows PowerShell 控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-107">Windows PowerShell Web Access, first introduced in Windows Server 2012, acts as a Windows PowerShell gateway, providing a web-based Windows PowerShell console that is targeted at a remote computer.</span></span> <span data-ttu-id="eda78-108">它可让 IT 专业人士在 Web 浏览器中运行来自 Windows PowerShell 控制台的 Windows PowerShell 命令和脚本，无需在客户端设备上安装 Windows PowerShell、远程管理软件或浏览器插件。</span><span class="sxs-lookup"><span data-stu-id="eda78-108">It enables IT Pros to run Windows PowerShell commands and scripts from a Windows PowerShell console in a web browser, with no Windows PowerShell, remote management software, or browser plug-in installation necessary on the client device.</span></span> <span data-ttu-id="eda78-109">运行基于 Web 的 Windows PowerShell 控制台只需要正确配置的 Windows PowerShell Web 访问网关以及支持 JavaScript 和接受 Cookie 的客户端设备浏览器。</span><span class="sxs-lookup"><span data-stu-id="eda78-109">All that is required to run the web-based Windows PowerShell console is a properly-configured Windows PowerShell Web Access gateway, and a client device browser that supports JavaScript and accepts cookies.</span></span>

<span data-ttu-id="eda78-110">客户端设备的示例包括便携式计算机、非工作的个人计算机、借来的计算机、平板计算机、Web 展台、不运行基于 Windows 的操作系统的计算机和手机浏览器。</span><span class="sxs-lookup"><span data-stu-id="eda78-110">Examples of client devices include laptops, non-work personal computers, borrowed computers, tablet computers, web kiosks, computers that are not running a Windows-based operating system, and cell phone browsers.</span></span> <span data-ttu-id="eda78-111">IT 专业人士可在远程基于 Windows 的服务器上执行重要的管理任务，这些服务器所属的设备配有 Web 浏览器，并可访问 Internet 连接。</span><span class="sxs-lookup"><span data-stu-id="eda78-111">IT Pros can perform critical management tasks on remote Windows-based servers from devices that have access to an Internet connection and a web browser.</span></span>

<span data-ttu-id="eda78-112">成功安装和配置网关后，用户可通过使用 Web 浏览器访问 Windows PowerShell 控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-112">After successful gateway setup and configuration, users can access a Windows PowerShell console by using a web browser.</span></span> <span data-ttu-id="eda78-113">当用户打开安全的 Windows PowerShell Web 访问网站时，他们可在成功通过身份验证后运行基于 Web 的 Windows PowerShell 控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-113">When users open the secured Windows PowerShell Web Access website, they can run a web-based Windows PowerShell console after successful authentication.</span></span>

<span data-ttu-id="eda78-114">Windows PowerShell Web 访问安装和配置过程包含三个步骤：</span><span class="sxs-lookup"><span data-stu-id="eda78-114">Windows PowerShell Web Access setup and configuration is a three-step process:</span></span>

1. [<span data-ttu-id="eda78-115">安装 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-115">Install Windows PowerShell Web Access</span></span>](#install-windows-powershell-web-access-using-powershell-cmdlets)
1. [<span data-ttu-id="eda78-116">配置网关</span><span class="sxs-lookup"><span data-stu-id="eda78-116">Configure the Gateway</span></span>](#configure-the-gateway)
1. [<span data-ttu-id="eda78-117">配置受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-117">Configure a restrictive authorization rule</span></span>](#configure-a-restrictive-authorization-rule)

<span data-ttu-id="eda78-118">安装和配置 Windows PowerShell Web Access 前，我们建议你阅读该完整指南，其中包括有关如何安装、保护和卸载 Windows PowerShell Web 访问的说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-118">Before you install and configure Windows PowerShell Web Access, we recommend that you read this entire guide, which includes instructions about how to install, secure, and uninstall Windows PowerShell Web Access.</span></span> <span data-ttu-id="eda78-119">[使用基于 Web 的 Windows PowerShell 控制台](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831417(v=ws.11))主题介绍了用户如何登录基于 Web 的控制台，并涵盖基于 Web 的 Windows PowerShell 控制台与 **powershell.exe** 控制台之间的限制和差异。</span><span class="sxs-lookup"><span data-stu-id="eda78-119">The [Use the Web-based Windows PowerShell Console](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831417(v=ws.11)) topic describes how users sign in to the web-based console, and covers limitations and differences between the web-based Windows PowerShell console and the **powershell.exe** console.</span></span> <span data-ttu-id="eda78-120">基于 Web 的控制台的最终用户应阅读[使用基于 Web 的 Windows PowerShell 控制台](use-the-web-based-windows-powershell-console.md)部分，但无需阅读本指南的其余部分。</span><span class="sxs-lookup"><span data-stu-id="eda78-120">End users of the web-based console should read [Use the Web based Windows PowerShell Console](use-the-web-based-windows-powershell-console.md), but do not need to read the rest of this guide.</span></span>

<span data-ttu-id="eda78-121">本主题并不提供详尽的 IIS Web Server 操作指导；仅描述配置 Windows PowerShell Web 访问网关所必需的步骤。</span><span class="sxs-lookup"><span data-stu-id="eda78-121">This topic does not provide in-depth IIS Web Server operations guidance; only those steps required to configure the Windows PowerShell Web Access gateway are described in this topic.</span></span> <span data-ttu-id="eda78-122">有关配置和保护 IIS 中的网站安全的详细信息，请参阅“另请参阅”部分中的 IIS 文档资源。</span><span class="sxs-lookup"><span data-stu-id="eda78-122">For more information about configuring and securing websites in IIS, see the IIS documentation resources in the See Also section.</span></span>

<span data-ttu-id="eda78-123">下图显示 Windows PowerShell Web 访问的工作原理。</span><span class="sxs-lookup"><span data-stu-id="eda78-123">The following diagram shows how Windows PowerShell Web Access works.</span></span>

![Windows PowerShell Web 访问图](media/install-and-use-windows-powershell-web-access/Windows-PowerShell-Web-Access-diagram.jpg)

## <a name="requirements-for-running-windows-powershell-web-access"></a><span data-ttu-id="eda78-125">运行 Windows PowerShell Web 访问的要求</span><span class="sxs-lookup"><span data-stu-id="eda78-125">Requirements for running Windows PowerShell Web Access</span></span>

<span data-ttu-id="eda78-126">Windows PowerShell Web 访问需要 Web 服务器 (IIS)、.NET Framework 4.5 和 Windows PowerShell 3.0 或 Windows PowerShell 4.0 在你想运行网关的服务器上运行。</span><span class="sxs-lookup"><span data-stu-id="eda78-126">Windows PowerShell Web Access requires Web Server (IIS), .NET Framework 4.5, and Windows PowerShell 3.0 or Windows PowerShell 4.0 to be running on the server on which you want to run the gateway.</span></span> <span data-ttu-id="eda78-127">通过使用服务器管理器中的“添加角色和功能向导”或适用于服务器管理器的 Windows PowerShell 部署 cmdlet，你可以在运行 Windows Server 2012 R2 或 Windows Server 2012 的服务器上安装 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-127">You can install Windows PowerShell Web Access on a server that is running Windows Server 2012 R2 or Windows Server 2012 by using either the Add Roles and Features Wizard in Server Manager, or Windows PowerShell deployment cmdlets for Server Manager.</span></span> <span data-ttu-id="eda78-128">当你使用服务器管理器或其部署 cmdlet 安装 Windows PowerShell Web 访问时，所需的角色和功能将在安装过程中自动添加。</span><span class="sxs-lookup"><span data-stu-id="eda78-128">When you install Windows PowerShell Web Access by using Server Manager or its deployment cmdlets, required roles and features are automatically added as part of the installation process.</span></span>

<span data-ttu-id="eda78-129">Windows PowerShell Web 访问可让远程用户使用 Web 浏览器中的 Windows PowerShell 访问你组织中的计算机。</span><span class="sxs-lookup"><span data-stu-id="eda78-129">Windows PowerShell Web Access allows remote users to access computers in your organization by using Windows PowerShell in a web browser.</span></span> <span data-ttu-id="eda78-130">虽然 Windows PowerShell Web 访问是便利和功能强大的管理工具，但基于 Web 的访问存在安全风险，应尽可能安全地配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-130">Although Windows PowerShell Web Access is a convenient and powerful management tool, the web-based access poses security risks, and should be configured as securely as possible.</span></span> <span data-ttu-id="eda78-131">我们建议配置 Windows PowerShell Web 访问网关的管理员使用可用的安全层，它们分别是包括在 Windows PowerShell Web 访问内的基于 cmdlet 的授权规则以及在 Web 服务器 (IIS) 中和第三方应用程序中可用的安全层。</span><span class="sxs-lookup"><span data-stu-id="eda78-131">We recommend that administrators who configure the Windows PowerShell Web Access gateway use available security layers, both the cmdlet-based authorization rules included with Windows PowerShell Web Access, and security layers that are available in Web Server (IIS) and third-party applications.</span></span> <span data-ttu-id="eda78-132">本文档包括仅建议在测试环境中使用的不安全示例以及建议在安全部署过程中使用的示例。</span><span class="sxs-lookup"><span data-stu-id="eda78-132">This documentation includes both unsecure examples that are only recommended for test environments, as well as examples that are recommended for secure deployments.</span></span>

## <a name="browser-and-client-device-support"></a><span data-ttu-id="eda78-133">浏览器和客户端设备支持</span><span class="sxs-lookup"><span data-stu-id="eda78-133">Browser and client device support</span></span>

<span data-ttu-id="eda78-134">Windows PowerShell Web 访问支持以下 Internet 浏览器。</span><span class="sxs-lookup"><span data-stu-id="eda78-134">Windows PowerShell Web Access supports the following Internet browsers.</span></span> <span data-ttu-id="eda78-135">虽然移动浏览器未正式受到支持，但许多此类浏览器均可运行基于 Web 的 Windows PowerShell 控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-135">Although mobile browsers are not officially supported, many may be able to run the web-based Windows PowerShell console.</span></span>
<span data-ttu-id="eda78-136">其他接受 Cookies、运行 JavaScript 和 HTTPS 网站的浏览器有望投入使用，但尚未接受正式测试。</span><span class="sxs-lookup"><span data-stu-id="eda78-136">Other browsers that accept cookies, run JavaScript, and run HTTPS websites are expected to work, but are not officially tested.</span></span>

### <a name="supported-desktop-computer-browsers"></a><span data-ttu-id="eda78-137">受支持的台式计算机浏览器</span><span class="sxs-lookup"><span data-stu-id="eda78-137">Supported desktop computer browsers</span></span>

- <span data-ttu-id="eda78-138">适用于 Microsoft Windows 8.0、9.0、10.0 和 11.0 的 Windows Internet Explorer</span><span class="sxs-lookup"><span data-stu-id="eda78-138">Windows Internet Explorer for Microsoft Windows 8.0, 9.0, 10.0, and 11.0</span></span>
- <span data-ttu-id="eda78-139">Mozilla Firefox 10.0.2</span><span class="sxs-lookup"><span data-stu-id="eda78-139">Mozilla Firefox 10.0.2</span></span>
- <span data-ttu-id="eda78-140">适用于 Windows 的 Google Chrome 17.0.963.56m</span><span class="sxs-lookup"><span data-stu-id="eda78-140">Google Chrome 17.0.963.56m for Windows</span></span>
- <span data-ttu-id="eda78-141">适用于 Windows 的 Apple Safari 5.1.2</span><span class="sxs-lookup"><span data-stu-id="eda78-141">Apple Safari 5.1.2 for Windows</span></span>
- <span data-ttu-id="eda78-142">适用于 Mac OS 的 Apple Safari 5.1.2</span><span class="sxs-lookup"><span data-stu-id="eda78-142">Apple Safari 5.1.2 for Mac OS</span></span>

### <a name="minimally-tested-mobile-devices-or-browsers"></a><span data-ttu-id="eda78-143">经过最小限度测试的移动设备或浏览器</span><span class="sxs-lookup"><span data-stu-id="eda78-143">Minimally-tested mobile devices or browsers</span></span>

- <span data-ttu-id="eda78-144">Windows Phone 7 和 7.5</span><span class="sxs-lookup"><span data-stu-id="eda78-144">Windows Phone 7 and 7.5</span></span>
- <span data-ttu-id="eda78-145">Google Android WebKit 3.1 Browser Android 2.2.1 (Kernel 2.6)</span><span class="sxs-lookup"><span data-stu-id="eda78-145">Google Android WebKit 3.1 Browser Android 2.2.1 (Kernel 2.6)</span></span>
- <span data-ttu-id="eda78-146">iPhone 操作系统 5.0.1 的 Apple Safari</span><span class="sxs-lookup"><span data-stu-id="eda78-146">Apple Safari for iPhone operating system 5.0.1</span></span>
- <span data-ttu-id="eda78-147">iPad 2 操作系统 5.0.1 的 Apple Safari</span><span class="sxs-lookup"><span data-stu-id="eda78-147">Apple Safari for iPad 2 operating system 5.0.1</span></span>

### <a name="browser-requirements"></a><span data-ttu-id="eda78-148">浏览器要求</span><span class="sxs-lookup"><span data-stu-id="eda78-148">Browser requirements</span></span>

<span data-ttu-id="eda78-149">若要使用 Windows PowerShell Web 访问基于 Web 的控制台，浏览器必须执行以下操作。</span><span class="sxs-lookup"><span data-stu-id="eda78-149">To use the Windows PowerShell Web Access web-based console, browsers must do the following.</span></span>

- <span data-ttu-id="eda78-150">允许 Windows PowerShell Web 访问网关网站中的 Cookie。</span><span class="sxs-lookup"><span data-stu-id="eda78-150">Allow cookies from the Windows PowerShell Web Access gateway website.</span></span>
- <span data-ttu-id="eda78-151">可打开和访问 HTTPS 页面。</span><span class="sxs-lookup"><span data-stu-id="eda78-151">Be able to open and read HTTPS pages.</span></span>
- <span data-ttu-id="eda78-152">打开和运行使用 JavaScript 的网站。</span><span class="sxs-lookup"><span data-stu-id="eda78-152">Open and run websites that use JavaScript.</span></span>

## <a name="recommended-quick-deployment"></a><span data-ttu-id="eda78-153">建议的快速部署</span><span class="sxs-lookup"><span data-stu-id="eda78-153">Recommended quick deployment</span></span>

<span data-ttu-id="eda78-154">通过使用 Windows PowerShell cmdlet 或从服务器管理器中打开的“添加角色和功能向导”，你可以在运行 Windows Server 2012 R2 或 Windows Server 2012 的服务器上安装 Windows PowerShell Web 访问网关。</span><span class="sxs-lookup"><span data-stu-id="eda78-154">You can install the Windows PowerShell Web Access gateway on a server that is running Windows Server 2012 R2 or Windows Server 2012 by using either Windows PowerShell cmdlets, or by using the Add Roles and Features Wizard that is opened from within Server Manager.</span></span> <span data-ttu-id="eda78-155">对于快速安装和配置，使用 Windows PowerShell cmdlet，如本部分中所述。</span><span class="sxs-lookup"><span data-stu-id="eda78-155">For quick installation and configuration, use Windows PowerShell cmdlets, as described in this section.</span></span>

1. [<span data-ttu-id="eda78-156">安装 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-156">Install Windows PowerShell Web Access</span></span>](#install-windows-powershell-web-access-using-powershell-cmdlets)
1. [<span data-ttu-id="eda78-157">配置网关</span><span class="sxs-lookup"><span data-stu-id="eda78-157">Configure the Gateway</span></span>](#configure-the-gateway)
1. [<span data-ttu-id="eda78-158">配置受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-158">Configure a restrictive authorization rule</span></span>](#configure-a-restrictive-authorization-rule)

### <a name="install-windows-powershell-web-access-using-powershell-cmdlets"></a><span data-ttu-id="eda78-159">使用 PowerShell cmdlet 安装 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-159">Install Windows PowerShell Web Access using PowerShell cmdlets</span></span>

#### <a name="to-install-windows-powershell-web-access-by-using-windows-powershell-cmdlets"></a><span data-ttu-id="eda78-160">使用 Windows PowerShell cmdlet 安装 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-160">To install Windows PowerShell Web Access by using Windows PowerShell cmdlets</span></span>

1. <span data-ttu-id="eda78-161">使用提升的用户权限执行以下操作之一打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-161">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="eda78-162">在 Windows 桌面上，右键单击任务栏上的**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-162">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>
   - <span data-ttu-id="eda78-163">在 Windows **开始**屏幕上，右键单击**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-163">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

   > [!NOTE]
   > <span data-ttu-id="eda78-164">在 Windows PowerShell 3.0 和 4.0 中，在运行作为模块一部分的 cmdlet 之前，无需将 Server Manager cmdlet 模块导入到 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-164">In Windows PowerShell 3.0 and 4.0, there is no need to import the Server Manager cmdlet module into the Windows PowerShell session before running cmdlets that are part of the module.</span></span> <span data-ttu-id="eda78-165">在你首次运行 cmdlet（模块的一部分）时，模块被自动导入。</span><span class="sxs-lookup"><span data-stu-id="eda78-165">A module is automatically imported the first time you run a cmdlet that is part of the module.</span></span>
   > <span data-ttu-id="eda78-166">此外，Windows PowerShell cmdlet 不区分大小写。</span><span class="sxs-lookup"><span data-stu-id="eda78-166">Also, Windows PowerShell cmdlets are not case-sensitive.</span></span>

1. <span data-ttu-id="eda78-167">键入以下内容，然后按 **Enter**，其中 *computer_name* 代表要安装 Windows PowerShell Web 访问的远程计算机（如果适用）。</span><span class="sxs-lookup"><span data-stu-id="eda78-167">Type the following, and then press **Enter**, where *computer_name* represents a remote computer on which you want to install Windows PowerShell Web Access, if applicable.</span></span> <span data-ttu-id="eda78-168">必要时，`-Restart` 参数自动重新启动目标服务器。</span><span class="sxs-lookup"><span data-stu-id="eda78-168">The `-Restart` parameter automatically restarts destination servers if required.</span></span>

   `Install-WindowsFeature -Name WindowsPowerShellWebAccess -ComputerName <computer_name> -IncludeManagementTools -Restart`

   > [!NOTE]
   > <span data-ttu-id="eda78-169">使用 Windows PowerShell cmdlet 安装 Windows PowerShell Web 访问在默认情况下不会添加 Web 服务器 (IIS) 管理工具。</span><span class="sxs-lookup"><span data-stu-id="eda78-169">Installing Windows PowerShell Web Access by using Windows PowerShell cmdlets does not add Web Server (IIS) management tools by default.</span></span> <span data-ttu-id="eda78-170">如果希望在相同的服务器上安装管理工具并用作 Windows PowerShell Web 访问网关，请将 `-IncludeManagementTools` 参数添加到安装命令（如本步骤所述）。</span><span class="sxs-lookup"><span data-stu-id="eda78-170">If you want to install the management tools on the same server as the Windows PowerShell Web Access gateway, add the `-IncludeManagementTools` parameter to the installation command (as provided in this step).</span></span> <span data-ttu-id="eda78-171">如果你通过远程计算机管理 Windows PowerShell Web 访问网站，请安装 IIS 管理器管理单元，方法是在你想通过其管理网关的计算机上安装[适用于 Windows 8.1 的远程服务器管理工具](https://www.microsoft.com/en-us/download/details.aspx?id=39296)或[适用于 Windows 8 的远程服务器管理工具](https://www.microsoft.com/en-us/download/details.aspx?id=28972)。</span><span class="sxs-lookup"><span data-stu-id="eda78-171">If you are managing the Windows PowerShell Web Access website from a remote computer, install the IIS Manager snap-in by installing [Remote Server Administration Tools for Windows 8.1](https://www.microsoft.com/en-us/download/details.aspx?id=39296) or [Remote Server Administration Tools for Windows 8](https://www.microsoft.com/en-us/download/details.aspx?id=28972) on the computer from which you want to manage the gateway.</span></span>

   <span data-ttu-id="eda78-172">若要在离线的 VHD 上安装角色和功能，你必须添加 `-ComputerName` 参数和 `-VHD` 参数。</span><span class="sxs-lookup"><span data-stu-id="eda78-172">To install roles and features on an offline VHD, you must add both the `-ComputerName` parameter and the `-VHD` parameter.</span></span> <span data-ttu-id="eda78-173">`-ComputerName` 参数包含要装载 VHD 的服务器的名称，`-VHD` 参数包含 VHD 文件在指定服务器上的路径。</span><span class="sxs-lookup"><span data-stu-id="eda78-173">The `-ComputerName` parameter contains the name of the server on which to mount the VHD, and the `-VHD` parameter contains the path to the VHD file on the specified server.</span></span>

   `Install-WindowsFeature -Name WindowsPowerShellWebAccess -VHD <path> -ComputerName <computer_name> -IncludeManagementTools -Restart`

1. <span data-ttu-id="eda78-174">安装完成后，验证 Windows PowerShell Web 访问是否已安装在目标服务器上，方法是：在使用提升的用户权限打开的 Windows PowerShell 控制台中，在目标服务器上运行 `Get-WindowsFeature` cmdlet。</span><span class="sxs-lookup"><span data-stu-id="eda78-174">When installation is complete, verify that Windows PowerShell Web Access was installed on destination servers by running the `Get-WindowsFeature` cmdlet on a destination server, in a Windows PowerShell console that has been opened with elevated user rights.</span></span> <span data-ttu-id="eda78-175">你还可以验证 Windows PowerShell Web 访问是否已安装在 Server Manager 控制台中，方法是在“所有服务器”  页面上选择目标服务器，然后查看所选服务器的“角色和功能”  磁贴。</span><span class="sxs-lookup"><span data-stu-id="eda78-175">You can also verify that Windows PowerShell Web Access was installed in the Server Manager console, by selecting a destination server on the **All Servers** page, and then viewing the **Roles and Features** tile for the selected server.</span></span> <span data-ttu-id="eda78-176">你还可以查看 Windows PowerShell Web 访问的自述文件。</span><span class="sxs-lookup"><span data-stu-id="eda78-176">You can also view the readme file for Windows PowerShell Web Access.</span></span>

1. <span data-ttu-id="eda78-177">安装 Windows PowerShell Web 访问后，系统将提示你查看自述文件，该文件包含网关的基本且必需的设置说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-177">After Windows PowerShell Web Access is installed, you are prompted to review the readme file, which contains basic, required setup instructions for the gateway.</span></span> <span data-ttu-id="eda78-178">有关这些设置说明，还可以参阅以下部分：[配置网关](#configure-the-gateway)。</span><span class="sxs-lookup"><span data-stu-id="eda78-178">These setup instructions are also in the following section, [Configure the Gateway](#configure-the-gateway).</span></span> <span data-ttu-id="eda78-179">自述文件路径为 `C:\Windows\Web\PowerShellWebAccess\wwwroot\README.txt`。</span><span class="sxs-lookup"><span data-stu-id="eda78-179">The path to the readme file is `C:\Windows\Web\PowerShellWebAccess\wwwroot\README.txt`.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="eda78-180">配置网关</span><span class="sxs-lookup"><span data-stu-id="eda78-180">Configure the Gateway</span></span>

<span data-ttu-id="eda78-181">使用 **Install-PswaWebApplication** cmdlet 可快速配置 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-181">The **Install-PswaWebApplication** cmdlet is a quick way to get Windows PowerShell Web Access configured.</span></span> <span data-ttu-id="eda78-182">虽然可将 `UseTestCertificate` 参数添加到 `Install-PswaWebApplication` cmdlet，以出于测试目的而安装自签名的 SSL 证书，但这种做法是不安全的；对安全的生产环境而言，应始终使用证书颁发机构 (CA) 已签名的有效的 SSL 证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-182">Although you can add the `UseTestCertificate` parameter to the `Install-PswaWebApplication` cmdlet to install a self-signed SSL certificate for test purposes, this is not secure; for a secure production environment, always use a valid SSL certificate that has been signed by a certification authority (CA).</span></span> <span data-ttu-id="eda78-183">管理员可通过 IIS 管理器控制台，使用自行选择的已签名证书代替测试证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-183">Administrators can replace the test certificate with a signed certificate of their choice by using the IIS Manager console.</span></span>

<span data-ttu-id="eda78-184">可完成 Windows PowerShell Web 访问 Web 应用程序配置，方法是运行 `Install-PswaWebApplication` cmdlet，或在 IIS Manager 中执行基于 GUI 的配置步骤。</span><span class="sxs-lookup"><span data-stu-id="eda78-184">You can complete Windows PowerShell Web Access web application configuration either by running the `Install-PswaWebApplication` cmdlet or by performing GUI-based configuration steps in IIS Manager.</span></span>
<span data-ttu-id="eda78-185">默认情况下，cmdlet 在**默认网站**容器中安装 Web 应用程序、**pswa**（及其应用程序池 **pswa_pool**），如 IIS 管理器所示；必要时，你可指示 cmdlet 更改 Web 应用程序的默认网站容器。</span><span class="sxs-lookup"><span data-stu-id="eda78-185">By default, the cmdlet installs the web application, **pswa** (and an application pool for it, **pswa_pool**), in the **Default Web Site** container, as shown in IIS Manager; if desired, you can instruct the cmdlet to change the default site container of the web application.</span></span> <span data-ttu-id="eda78-186">IIS 管理器提供可供 Web 应用程序使用的配置选项，例如更改端口号或安全套接字层 (SSL) 证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-186">IIS Manager offers configuration options that are available for web applications, such as changing the port number or the Secure Sockets Layer (SSL) certificate.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="eda78-187">我们强烈推荐管理员配置网关，以使用 CA 已签名的有效证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-187">We strongly recommend that administrators configure the gateway to use a valid certificate that has been signed by a CA.</span></span>

#### <a name="to-configure-the-windows-powershell-web-access-gateway-with-a-test-certificate-by-using-install-pswawebapplication"></a><span data-ttu-id="eda78-188">使用 Install-PswaWebApplication，配置带有测试证书的 Windows PowerShell Web 访问网关。</span><span class="sxs-lookup"><span data-stu-id="eda78-188">To configure the Windows PowerShell Web Access gateway with a test certificate by using Install-PswaWebApplication</span></span>

1. <span data-ttu-id="eda78-189">执行以下操作之一，打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-189">Do one of the following to open a Windows PowerShell session.</span></span>

   - <span data-ttu-id="eda78-190">在 Windows 桌面上，右键单击任务栏上的 Windows PowerShell  。</span><span class="sxs-lookup"><span data-stu-id="eda78-190">On the Windows desktop, right-click **Windows PowerShell** on the taskbar.</span></span>
   - <span data-ttu-id="eda78-191">在 Windows **开始**屏幕上，单击**Windows PowerShell**。</span><span class="sxs-lookup"><span data-stu-id="eda78-191">On the Windows **Start** screen, click **Windows PowerShell**.</span></span>

2. <span data-ttu-id="eda78-192">键入以下命令，然后按**Enter**。</span><span class="sxs-lookup"><span data-stu-id="eda78-192">Type the following, and then press **Enter**.</span></span>

   `Install-PswaWebApplication -UseTestCertificate`

   > [!IMPORTANT]
   > <span data-ttu-id="eda78-193">`UseTestCertificate` 参数仅可在专用测试环境中使用。</span><span class="sxs-lookup"><span data-stu-id="eda78-193">The `UseTestCertificate` parameter should only be used in a private test environment.</span></span> <span data-ttu-id="eda78-194">对于安全的生产环境，建议使用证书颁发机构已签名的有效证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-194">For a secure production environment, we recommend using a valid certificate that has been signed by a CA.</span></span>

   <span data-ttu-id="eda78-195">通过运行 cmdlet，在 IIS 默认网站容器中安装 Windows PowerShell Web 访问 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="eda78-195">Running the cmdlet installs the Windows PowerShell Web Access web application within the IIS Default Web Site container.</span></span> <span data-ttu-id="eda78-196">cmdlet 创建在默认网站 `https://<server_name>/pswa` 上运行 Windows PowerShell Web 访问所必需的基础结构。</span><span class="sxs-lookup"><span data-stu-id="eda78-196">The cmdlet creates the infrastructure required to run Windows PowerShell Web Access on the default website, `https://<server_name>/pswa`.</span></span> <span data-ttu-id="eda78-197">若要在不同的网站上安装 Web 应用程序，请添加 `WebSiteName` 参数，以提供网站名称。</span><span class="sxs-lookup"><span data-stu-id="eda78-197">To install the web application in a different website, provide the website name by adding the `WebSiteName` parameter.</span></span> <span data-ttu-id="eda78-198">若要更改 Web 应用程序的名称（默认名称是 `pswa`），请添加 `WebApplicationName` 参数。</span><span class="sxs-lookup"><span data-stu-id="eda78-198">To change the name of the web application (the default is `pswa`), add the `WebApplicationName` parameter.</span></span>

   <span data-ttu-id="eda78-199">通过运行 cmdlet，配置以下设置。</span><span class="sxs-lookup"><span data-stu-id="eda78-199">The following settings are configured by running the cmdlet.</span></span> <span data-ttu-id="eda78-200">必要时，你可在 IIS 管理器控制台中手动更改这些设置。</span><span class="sxs-lookup"><span data-stu-id="eda78-200">You can change these manually in the IIS Manager console, if desired.</span></span>

   - <span data-ttu-id="eda78-201">Path: /pswa</span><span class="sxs-lookup"><span data-stu-id="eda78-201">Path: /pswa</span></span>
   - <span data-ttu-id="eda78-202">ApplicationPool: pswa_pool</span><span class="sxs-lookup"><span data-stu-id="eda78-202">ApplicationPool: pswa_pool</span></span>
   - <span data-ttu-id="eda78-203">EnabledProtocols: http</span><span class="sxs-lookup"><span data-stu-id="eda78-203">EnabledProtocols: http</span></span>
   - <span data-ttu-id="eda78-204">PhysicalPath: %windir%/Web/PowerShellWebAccess/wwwroot</span><span class="sxs-lookup"><span data-stu-id="eda78-204">PhysicalPath: %windir%/Web/PowerShellWebAccess/wwwroot</span></span>

   <span data-ttu-id="eda78-205">示例：`Install-PswaWebApplication -webApplicationName myWebApp -useTestCertificate`</span><span class="sxs-lookup"><span data-stu-id="eda78-205">**Example**: `Install-PswaWebApplication -webApplicationName myWebApp -useTestCertificate`</span></span>

   <span data-ttu-id="eda78-206">在本示例中，Windows PowerShell Web 访问的相关网站是 `https://<server_name>/myWebApp`。</span><span class="sxs-lookup"><span data-stu-id="eda78-206">In this example, the resulting website for Windows PowerShell Web Access is `https://<server_name>/myWebApp`.</span></span>

   > [!NOTE]
   > <span data-ttu-id="eda78-207">你将无法登录，直到用户通过添加授权规则，获得访问该网站的权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-207">You cannot sign in until users have been granted access to the website by adding authorization rules.</span></span> <span data-ttu-id="eda78-208">有关详细信息，请参阅[配置受限的授权规则](#configure-a-restrictive-authorization-rule)和 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-208">For more information, see [configure a restrictive authorization rule](#configure-a-restrictive-authorization-rule) and [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

#### <a name="to-configure-the-windows-powershell-web-access-gateway-with-a-genuine-certificate-by-using-install-pswawebapplication-and-iis-manager"></a><span data-ttu-id="eda78-209">使用 Install-PswaWebApplication 和 IIS 管理器，配置带有正版证书的 Windows PowerShell Web 访问网关</span><span class="sxs-lookup"><span data-stu-id="eda78-209">To configure the Windows PowerShell Web Access gateway with a genuine certificate by using Install-PswaWebApplication and IIS Manager</span></span>

1. <span data-ttu-id="eda78-210">执行以下操作之一，打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-210">Do one of the following to open a Windows PowerShell session.</span></span>

   - <span data-ttu-id="eda78-211">在 Windows 桌面上，右键单击任务栏上的 Windows PowerShell  。</span><span class="sxs-lookup"><span data-stu-id="eda78-211">On the Windows desktop, right-click **Windows PowerShell** on the taskbar.</span></span>
   - <span data-ttu-id="eda78-212">在 Windows **开始**屏幕上，单击**Windows PowerShell**。</span><span class="sxs-lookup"><span data-stu-id="eda78-212">On the Windows **Start** screen, click **Windows PowerShell**.</span></span>

2. <span data-ttu-id="eda78-213">键入以下命令，然后按**Enter**。</span><span class="sxs-lookup"><span data-stu-id="eda78-213">Type the following, and then press **Enter**.</span></span>

   `Install-PswaWebApplication`

   <span data-ttu-id="eda78-214">通过运行 cmdlet，配置以下网关设置。</span><span class="sxs-lookup"><span data-stu-id="eda78-214">The following gateway settings are configured by running the cmdlet.</span></span> <span data-ttu-id="eda78-215">必要时，你可在 IIS 管理器控制台中手动更改这些设置。</span><span class="sxs-lookup"><span data-stu-id="eda78-215">You can change these manually in the IIS Manager console, if desired.</span></span> <span data-ttu-id="eda78-216">你还可为 `Install-PswaWebApplication` cmdlet 的 `WebsiteName` 和 `WebApplicationName` 参数指定值。</span><span class="sxs-lookup"><span data-stu-id="eda78-216">You can also specify values for the `WebsiteName` and `WebApplicationName` parameters of the `Install-PswaWebApplication` cmdlet.</span></span>

   - <span data-ttu-id="eda78-217">Path: /pswa</span><span class="sxs-lookup"><span data-stu-id="eda78-217">Path: /pswa</span></span>
   - <span data-ttu-id="eda78-218">ApplicationPool: pswa_pool</span><span class="sxs-lookup"><span data-stu-id="eda78-218">ApplicationPool: pswa_pool</span></span>
   - <span data-ttu-id="eda78-219">EnabledProtocols: http</span><span class="sxs-lookup"><span data-stu-id="eda78-219">EnabledProtocols: http</span></span>
   - <span data-ttu-id="eda78-220">PhysicalPath: %windir%/Web/PowerShellWebAccess/wwwroot</span><span class="sxs-lookup"><span data-stu-id="eda78-220">PhysicalPath: %windir%/Web/PowerShellWebAccess/wwwroot</span></span>

3. <span data-ttu-id="eda78-221">通过执行以下操作之一，打开 IIS 管理器控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-221">Open the IIS Manager console by doing one of the following.</span></span>

   - <span data-ttu-id="eda78-222">在 Windows 桌面上，启动服务器管理器，方法是单击 Windows 任务栏中的“服务器管理器”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-222">On the Windows desktop, start Server Manager by clicking **Server Manager** in the Windows taskbar.</span></span> <span data-ttu-id="eda78-223">在“服务器管理器”的**工具**菜单中，单击**Internet Information Services (IIS) Manager**。</span><span class="sxs-lookup"><span data-stu-id="eda78-223">On the **Tools** menu in Server Manager, click **Internet Information Services (IIS) Manager**.</span></span>
   - <span data-ttu-id="eda78-224">在 Windows **开始**屏幕上，单击**服务器管理器**。</span><span class="sxs-lookup"><span data-stu-id="eda78-224">On the Windows **Start** screen, click **Server Manager**.</span></span>

4. <span data-ttu-id="eda78-225">在 IIS 管理器树窗格中，展开已安装 Windows PowerShell Web 访问的服务器的节点，直到“站点”  文件夹可见。</span><span class="sxs-lookup"><span data-stu-id="eda78-225">In the IIS Manager tree pane, expand the node for the server on which Windows PowerShell Web Access is installed until the **Sites** folder is visible.</span></span> <span data-ttu-id="eda78-226">展开“网站”  文件夹。</span><span class="sxs-lookup"><span data-stu-id="eda78-226">Expand the **Sites** folder.</span></span>

5. <span data-ttu-id="eda78-227">选择你已安装 Windows PowerShell Web 访问的 Web 应用程序的网站。</span><span class="sxs-lookup"><span data-stu-id="eda78-227">Select the website in which you have installed the Windows PowerShell Web Access web application.</span></span>
   <span data-ttu-id="eda78-228">在**操作**窗格中，单击**绑定**。</span><span class="sxs-lookup"><span data-stu-id="eda78-228">In the **Actions** pane, click **Bindings**.</span></span>

6. <span data-ttu-id="eda78-229">在**网站绑定**对话框中，单击**添加**。</span><span class="sxs-lookup"><span data-stu-id="eda78-229">In the **Site Binding** dialog box, click **Add**.</span></span>

7. <span data-ttu-id="eda78-230">在**添加网站绑定**对话框中，在**类型**字段，选择**https**。</span><span class="sxs-lookup"><span data-stu-id="eda78-230">In the **Add Site Binding** dialog box, in the **Type** field, select **https**.</span></span>

8. <span data-ttu-id="eda78-231">在“SSL 证书”  字段中，从下拉菜单中选择你的已签名证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-231">In the **SSL certificate** field, select your signed certificate from the drop-down menu.</span></span>
   <span data-ttu-id="eda78-232">单击“确定”。 </span><span class="sxs-lookup"><span data-stu-id="eda78-232">Click **OK**.</span></span> <span data-ttu-id="eda78-233">有关如何获得证书的详细信息，请参阅本主题中的[在 IIS 管理器中配置 SSL 证书](#to-configure-an-ssl-certificate-in-iis-manager)。</span><span class="sxs-lookup"><span data-stu-id="eda78-233">See [To configure an SSL certificate in IIS Manager](#to-configure-an-ssl-certificate-in-iis-manager) in this topic for more information about how to obtain a certificate.</span></span>

   <span data-ttu-id="eda78-234">现可配置 Windows PowerShell Web 访问 Web 应用程序，以便使用已签名的 SSL 证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-234">The Windows PowerShell Web Access web application is now configured to use your signed SSL certificate.</span></span>

   <span data-ttu-id="eda78-235">可以通过在浏览器窗口中打开 `https://<server_name>/pswa` 来访问 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-235">You can access Windows PowerShell Web Access by opening `https://<server_name>/pswa` in a browser window.</span></span>

   > [!NOTE]
   > <span data-ttu-id="eda78-236">你将无法登录，直到用户通过添加授权规则，获得访问该网站的权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-236">You cannot sign in until users have been granted access to the website by adding authorization rules.</span></span> <span data-ttu-id="eda78-237">有关详细信息，请参阅本部分中的[配置受限的授权规则](#configure-a-restrictive-authorization-rule)和 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-237">For more information, see [Configure a restrictive authorization rule](#configure-a-restrictive-authorization-rule), in this topic, and [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

### <a name="configure-a-restrictive-authorization-rule"></a><span data-ttu-id="eda78-238">配置受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-238">Configure a restrictive authorization rule</span></span>

<span data-ttu-id="eda78-239">安装 Windows PowerShell Web 访问和配置网关后，用户可在浏览器中打开登录页面，但他们无法登录，直到 Windows PowerShell Web 访问管理员明确授予用户访问权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-239">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="eda78-240">Windows PowerShell Web 访问的访问控制通过使用下表所述的 Windows PowerShell cmdlet 集进行管理。</span><span class="sxs-lookup"><span data-stu-id="eda78-240">Windows PowerShell Web Access access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="eda78-241">没有相当的 GUI 可用于添加或管理授权规则。</span><span class="sxs-lookup"><span data-stu-id="eda78-241">There is no comparable GUI for adding or managing authorization rules.</span></span> <span data-ttu-id="eda78-242">有关 Windows PowerShell Web 访问 cmdlet 的更多详细信息，请参阅 cmdlet 参考主题 [Windows PowerShell Web 访问 Cmdlet](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)。</span><span class="sxs-lookup"><span data-stu-id="eda78-242">For more detailed information about Windows PowerShell Web Access cmdlets, see the cmdlet reference topics, [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span></span>

<span data-ttu-id="eda78-243">有关 Windows PowerShell Web 访问授权规则和安全性的详细信息，请参阅 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-243">For more detail about Windows PowerShell Web Access authorization rules and security, see [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

#### <a name="to-add-a-restrictive-authorization-rule"></a><span data-ttu-id="eda78-244">添加受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-244">To add a restrictive authorization rule</span></span>

1. <span data-ttu-id="eda78-245">使用提升的用户权限执行以下操作之一打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-245">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="eda78-246">在 Windows 桌面上，右键单击任务栏上的**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-246">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>
   - <span data-ttu-id="eda78-247">在 Windows **开始**屏幕上，右键单击**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-247">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

2. <span data-ttu-id="eda78-248">使用会话配置限制用户访问的可选步骤：确保规则中已经存在要使用的会话配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-248">Optional step for restricting user access by using session configurations: Verify that session configurations that you want to use in your rules already exist.</span></span> <span data-ttu-id="eda78-249">如果尚未创建这些配置，则使用 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configurations) 中用于创建会话配置的说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-249">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configurations).</span></span>

3. <span data-ttu-id="eda78-250">键入以下命令，然后按**Enter**。</span><span class="sxs-lookup"><span data-stu-id="eda78-250">Type the following, and then press **Enter**.</span></span>

   `Add-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName <computer_name> -ConfigurationName <session_configuration_name>`

   <span data-ttu-id="eda78-251">本授权规则允许特定用户通过他们通常访问的网络访问一台计算机，以及可让特定用户拥有对满足用户常见脚本和 cmdlet 需求的特定会话配置的权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-251">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user's typical scripting and cmdlet needs.</span></span>

   <span data-ttu-id="eda78-252">在以下示例中，`Contoso` 域中名为 `JSmith` 的用户获得访问权限，以管理计算机 `Contoso_214`，并使用名为 `NewAdminsOnly` 的会话配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-252">In the following example, a user named `JSmith` in the `Contoso` domain is granted access to manage the computer `Contoso_214`, and use a session configuration named `NewAdminsOnly`.</span></span>

   `Add-PswaAuthorizationRule -UserName Contoso\JSmith -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly`

4. <span data-ttu-id="eda78-253">验证是否已通过运行 `Get-PswaAuthorizationRule` cmdlet 或 `Test-PswaAuthorizationRule -UserName <domain\user> -ComputerName <computer-name>` 创建了规则</span><span class="sxs-lookup"><span data-stu-id="eda78-253">Verify that the rule has been created by running either the `Get-PswaAuthorizationRule` cmdlet, or `Test-PswaAuthorizationRule -UserName <domain\user> -ComputerName <computer-name>`</span></span>

   <span data-ttu-id="eda78-254">例如，`Test-PswaAuthorizationRule -UserName 'Contoso\JSmith' -ComputerName Contoso_214` 。</span><span class="sxs-lookup"><span data-stu-id="eda78-254">For example, `Test-PswaAuthorizationRule -UserName 'Contoso\JSmith' -ComputerName Contoso_214`.</span></span>

<span data-ttu-id="eda78-255">配置授权规则之后，授权用户便可以登录基于 Web 的控制台并开始使用 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-255">After you have configured an authorization rule, you are ready for authorized users to sign in to the web-based console and begin using Windows PowerShell Web Access.</span></span>

## <a name="custom-deployment"></a><span data-ttu-id="eda78-256">自定义部署</span><span class="sxs-lookup"><span data-stu-id="eda78-256">Custom deployment</span></span>

<span data-ttu-id="eda78-257">通过使用服务器管理器中的“添加角色和功能向导”，你可以在运行 Windows Server 2012 R2 或 Windows Server 2012 的服务器上安装 Windows PowerShell Web 访问网关。</span><span class="sxs-lookup"><span data-stu-id="eda78-257">You can install the Windows PowerShell Web Access gateway on a server that is running Windows Server 2012 R2 or Windows Server 2012 by using the Add Roles and Features Wizard in Server Manager.</span></span>
<span data-ttu-id="eda78-258">安装 Windows PowerShell Web 访问之后，可以在 IIS 管理器中自定义网关的配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-258">After Windows PowerShell Web Access is installed, you can customize the configuration of the gateway in IIS Manager.</span></span>

### <a name="install-windows-powershell-web-access-using-the-add-roles-and-features-wizard"></a><span data-ttu-id="eda78-259">使用“添加角色和功能向导”安装 Windows PowerShell Web 访问</span><span class="sxs-lookup"><span data-stu-id="eda78-259">Install Windows PowerShell Web Access using the Add Roles and Features Wizard</span></span>

1. <span data-ttu-id="eda78-260">如果服务器管理器已经打开，则继续执行下一步。</span><span class="sxs-lookup"><span data-stu-id="eda78-260">If Server Manager is already open, go on to the next step.</span></span> <span data-ttu-id="eda78-261">如果服务器管理器尚未打开，请执行以下任一操作打开它。</span><span class="sxs-lookup"><span data-stu-id="eda78-261">If Server Manager is not already open, open it by doing one of the following.</span></span>

   - <span data-ttu-id="eda78-262">在 Windows 桌面上，启动服务器管理器，方法是单击 Windows 任务栏中的“服务器管理器”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-262">On the Windows desktop, start Server Manager by clicking **Server Manager** in the Windows taskbar.</span></span>
   - <span data-ttu-id="eda78-263">在 Windows **开始**屏幕上，单击**服务器管理器**。</span><span class="sxs-lookup"><span data-stu-id="eda78-263">On the Windows **Start** screen, click **Server Manager**.</span></span>

2. <span data-ttu-id="eda78-264">在**管理**菜单上，单击**添加角色和功能**。</span><span class="sxs-lookup"><span data-stu-id="eda78-264">On the **Manage** menu, click **Add Roles and Features**.</span></span>

3. <span data-ttu-id="eda78-265">在“选择安装类型”页上，选择“基于角色或基于功能的安装”。  </span><span class="sxs-lookup"><span data-stu-id="eda78-265">On the **Select installation type** page, select **Role-based or feature-based installation**.</span></span>
   <span data-ttu-id="eda78-266">单击“下一步”。 </span><span class="sxs-lookup"><span data-stu-id="eda78-266">Click **Next**.</span></span>

4. <span data-ttu-id="eda78-267">在“选择目标服务器”  页面上，从服务器池中选择一台服务器，或选择脱机 VHD。</span><span class="sxs-lookup"><span data-stu-id="eda78-267">On the **Select destination server** page, select a server from the server pool, or select an offline VHD.</span></span> <span data-ttu-id="eda78-268">若要将离线的 VHD 选择为你的目标服务器，则先选择安装 VHD 的服务器，然后选择 VHD 文件。</span><span class="sxs-lookup"><span data-stu-id="eda78-268">To select an offline VHD as your destination server, first select the server on which to mount the VHD, and then select the VHD file.</span></span> <span data-ttu-id="eda78-269">有关如何将服务器添加到服务器池的详细信息，请参阅服务器管理器帮助。</span><span class="sxs-lookup"><span data-stu-id="eda78-269">For information about how to add servers to your server pool, see the Server Manager Help.</span></span> <span data-ttu-id="eda78-270">选择目标服务器后，单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="eda78-270">After you have selected the destination server, click **Next**.</span></span>

5. <span data-ttu-id="eda78-271">在向导的**选择功能**页面上，展开**Windows PowerShell**，然后选择**Windows PowerShell Web 访问**。</span><span class="sxs-lookup"><span data-stu-id="eda78-271">On the **Select features** page of the wizard, expand **Windows PowerShell**, and then select **Windows PowerShell Web Access**.</span></span>

6. <span data-ttu-id="eda78-272">注意，系统提示你添加所需的功能，例如 .NET Framework 4.5 以及 Web 服务器 (IIS) 的角色服务。</span><span class="sxs-lookup"><span data-stu-id="eda78-272">Note that you are prompted to add required features, such as .NET Framework 4.5, and role services of Web Server (IIS).</span></span> <span data-ttu-id="eda78-273">添加所需的功能并继续操作。</span><span class="sxs-lookup"><span data-stu-id="eda78-273">Add required features and continue.</span></span>

   > [!NOTE]
   > <span data-ttu-id="eda78-274">通过使用“添加角色和功能向导”安装 Windows PowerShell Web 访问还将安装 Web 服务器 (IIS)，包括 IIS 管理器管理单元。</span><span class="sxs-lookup"><span data-stu-id="eda78-274">Installing Windows PowerShell Web Access by using the Add Roles and Features Wizard also installs Web Server (IIS), including the IIS Manager snap-in.</span></span> <span data-ttu-id="eda78-275">如果你使用“添加角色和功能向导”，则在默认情况下，也安装了管理单元及其他 IIS 管理工具。</span><span class="sxs-lookup"><span data-stu-id="eda78-275">The snap-in and other IIS management tools are installed by default if you use Add Roles and Features Wizard.</span></span> <span data-ttu-id="eda78-276">如果你按照以下步骤，使用 Windows PowerShell cmdlet 安装 Windows PowerShell Web 访问，则不会默认添加管理工具。</span><span class="sxs-lookup"><span data-stu-id="eda78-276">If you install Windows PowerShell Web Access by using Windows PowerShell cmdlets as described in the following procedure, management tools are not added by default.</span></span>

7. <span data-ttu-id="eda78-277">在“确认安装选择”  页面上，如果 Windows PowerShell Web 访问的功能文件并不存储在你在步骤 4 中所选的目标服务器上，则单击“指定备用的源路径”  ，并提供功能文件的路径。</span><span class="sxs-lookup"><span data-stu-id="eda78-277">On the **Confirm installation selections** page, if the feature files for Windows PowerShell Web Access are not stored on the destination server that you selected in step 4, click **Specify an alternate source path**, and provide the path to the feature files.</span></span> <span data-ttu-id="eda78-278">否则，单击**安装**。</span><span class="sxs-lookup"><span data-stu-id="eda78-278">Otherwise, click **Install**.</span></span>

8. <span data-ttu-id="eda78-279">单击“安装”  后，“安装进度”  页面将显示安装进度、结果以及有关警告、故障或 Windows PowerShell Web 访问所必需的安装后配置步骤的信息。</span><span class="sxs-lookup"><span data-stu-id="eda78-279">After you click **Install**, the **Installation progress** page displays installation progress, results, and messages such as warnings, failures, or post-installation configuration steps that are required for Windows PowerShell Web Access.</span></span> <span data-ttu-id="eda78-280">安装 Windows PowerShell Web 访问后，系统将提示你查看自述文件，该文件包含网关的基本且必需的设置说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-280">After Windows PowerShell Web Access is installed, you are prompted to review the readme file, which contains basic, required setup instructions for the gateway.</span></span> <span data-ttu-id="eda78-281">这些说明也包括在本主题中。</span><span class="sxs-lookup"><span data-stu-id="eda78-281">These instructions are also included in this topic.</span></span> <span data-ttu-id="eda78-282">自述文件路径为 `C:\Windows\Web\PowerShellWebAccess\wwwroot\README.txt`。</span><span class="sxs-lookup"><span data-stu-id="eda78-282">The path to the readme file is `C:\Windows\Web\PowerShellWebAccess\wwwroot\README.txt`.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="eda78-283">配置网关</span><span class="sxs-lookup"><span data-stu-id="eda78-283">Configure the gateway</span></span>

<span data-ttu-id="eda78-284">本部分中的说明涉及在网站的子目录（而非根目录）中安装 Windows PowerShell Web 访问 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="eda78-284">Instructions in this section are for installing the Windows PowerShell Web Access web application in a subdirectory and not in the root directory of your website.</span></span> <span data-ttu-id="eda78-285">本步骤与 `Install-PswaWebApplication` cmdlet 执行的基于 GUI 的操作等效。</span><span class="sxs-lookup"><span data-stu-id="eda78-285">This procedure is the GUI-based equivalent of the actions performed by the `Install-PswaWebApplication` cmdlet.</span></span> <span data-ttu-id="eda78-286">本部分还包括有关如何使用 IIS 管理器将 Windows PowerShell Web 访问网关配置为根网站的说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-286">This section also includes instructions for how to use IIS Manager to configure the Windows PowerShell Web Access gateway as a root website.</span></span>

#### <a name="to-use-iis-manager-to-configure-the-gateway-in-an-existing-website"></a><span data-ttu-id="eda78-287">使用 IIS 管理器在现有的网站中配置网关</span><span class="sxs-lookup"><span data-stu-id="eda78-287">To use IIS Manager to configure the gateway in an existing website</span></span>

1. <span data-ttu-id="eda78-288">通过执行以下操作之一，打开 IIS 管理器控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-288">Open the IIS Manager console by doing one of the following.</span></span>

   - <span data-ttu-id="eda78-289">在 Windows 桌面上，启动服务器管理器，方法是单击 Windows 任务栏中的“服务器管理器”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-289">On the Windows desktop, start Server Manager by clicking **Server Manager** in the Windows taskbar.</span></span> <span data-ttu-id="eda78-290">在“服务器管理器”的**工具**菜单中，单击**Internet Information Services (IIS) Manager**。</span><span class="sxs-lookup"><span data-stu-id="eda78-290">On the **Tools** menu in Server Manager, click **Internet Information Services (IIS) Manager**.</span></span>
   - <span data-ttu-id="eda78-291">在 Windows“开始”  屏幕上，键入“Internet 信息服务 (IIS) 管理器”  名称的任何部分。</span><span class="sxs-lookup"><span data-stu-id="eda78-291">On the Windows **Start** screen, type any part of the name **Internet Information Services (IIS) Manager**.</span></span> <span data-ttu-id="eda78-292">当它在“应用程序”  结果中显示时，单击快捷方式。</span><span class="sxs-lookup"><span data-stu-id="eda78-292">Click the shortcut when it is displayed in the **Apps** results.</span></span>

2. <span data-ttu-id="eda78-293">为 Windows PowerShell Web 访问创建新的应用程序池。</span><span class="sxs-lookup"><span data-stu-id="eda78-293">Create a new application pool for Windows PowerShell Web Access.</span></span> <span data-ttu-id="eda78-294">在 IIS 管理器树窗格中展开网关服务器的节点，选择“应用程序池”，然后单击“操作”窗格中的“添加应用程序池”。</span><span class="sxs-lookup"><span data-stu-id="eda78-294">Expand the node of the gateway server in the IIS Manager tree pane, select **Application Pools**, and click **Add Application Pool** in the **Actions** pane.</span></span>

3. <span data-ttu-id="eda78-295">为新的应用程序池添加名称 **pswa_pool**，或提供其他名称。</span><span class="sxs-lookup"><span data-stu-id="eda78-295">Add a new application pool with the name **pswa_pool**, or provide another name.</span></span> <span data-ttu-id="eda78-296">单击“确定”。 </span><span class="sxs-lookup"><span data-stu-id="eda78-296">Click **OK**.</span></span>

4. <span data-ttu-id="eda78-297">在 IIS 管理器树窗格中，展开已安装 Windows PowerShell Web 访问的服务器的节点，直到“站点”  文件夹可见。</span><span class="sxs-lookup"><span data-stu-id="eda78-297">In the IIS Manager tree pane, expand the node for the server on which Windows PowerShell Web Access is installed until the **Sites** folder is visible.</span></span> <span data-ttu-id="eda78-298">选择“站点”  文件夹。</span><span class="sxs-lookup"><span data-stu-id="eda78-298">Select the **Sites** folder.</span></span>

5. <span data-ttu-id="eda78-299">右键单击你想添加 Windows PowerShell Web 访问网站的网站（例如，**默认网站**），然后单击**添加应用程序**。</span><span class="sxs-lookup"><span data-stu-id="eda78-299">Right-click the website (for example, **Default Web Site**) to which you would like to add the Windows PowerShell Web Access website, and then click **Add Application**.</span></span>

6. <span data-ttu-id="eda78-300">在“别名”  字段中，键入 pswa 或提供其他别名。</span><span class="sxs-lookup"><span data-stu-id="eda78-300">In the **Alias** field, type pswa, or provide another alias.</span></span> <span data-ttu-id="eda78-301">别名变为虚拟目录的名称。</span><span class="sxs-lookup"><span data-stu-id="eda78-301">The alias becomes the virtual directory name.</span></span> <span data-ttu-id="eda78-302">例如，在以下 URL 中的 pswa  表示在本步骤中指定的别名：`https://<server-name>/pswa`。</span><span class="sxs-lookup"><span data-stu-id="eda78-302">For example, **pswa** in the following URL represents the alias specified in this step: `https://<server-name>/pswa`.</span></span>

7. <span data-ttu-id="eda78-303">在“应用程序池”  字段中，选择在步骤 3 中创建的应用程序池。</span><span class="sxs-lookup"><span data-stu-id="eda78-303">In the **Application pool** field, select the application pool that you created in step 3.</span></span>

8. <span data-ttu-id="eda78-304">在“物理路径”  字段中，浏览到应用程序的位置。</span><span class="sxs-lookup"><span data-stu-id="eda78-304">In the **Physical path** field, browse for the location of the application.</span></span> <span data-ttu-id="eda78-305">可以使用默认位置 `$env:windir/Web/PowerShellWebAccess/wwwroot`。</span><span class="sxs-lookup"><span data-stu-id="eda78-305">You can use the default location, `$env:windir/Web/PowerShellWebAccess/wwwroot`.</span></span> <span data-ttu-id="eda78-306">单击“确定”。 </span><span class="sxs-lookup"><span data-stu-id="eda78-306">Click **OK**.</span></span>

9. <span data-ttu-id="eda78-307">按照本主题中的过程 [在 IIS 管理器中配置 SSL 证书](#to-configure-an-ssl-certificate-in-iis-manager) 中的步骤执行。</span><span class="sxs-lookup"><span data-stu-id="eda78-307">Follow the steps in the procedure [To configure an SSL certificate in IIS Manager](#to-configure-an-ssl-certificate-in-iis-manager) in this topic.</span></span>

10. <span data-ttu-id="eda78-308">可选安全步骤：</span><span class="sxs-lookup"><span data-stu-id="eda78-308">Optional security step:</span></span>

    <span data-ttu-id="eda78-309">利用树窗格中所选的网站，双击内容窗格中的“SSL 设置”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-309">With the website selected in the tree pane, double-click **SSL Settings** in the content pane.</span></span>
    <span data-ttu-id="eda78-310">选择“需要 SSL”  ，然后在“操作”  窗格中，单击“应用”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-310">Select **Require SSL**, and then in the **Actions** pane, click **Apply**.</span></span> <span data-ttu-id="eda78-311">此外，在“SSL 设置”  窗格中，你可要求连接到 Windows PowerShell Web 访问网站的用户持有客户端证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-311">Optionally, in the **SSL Settings** pane, you can require that users connecting to the Windows PowerShell Web Access website have client certificates.</span></span> <span data-ttu-id="eda78-312">客户端证书可协助验证客户端设备用户的身份。</span><span class="sxs-lookup"><span data-stu-id="eda78-312">Client certificates help to verify the identity of a client device user.</span></span> <span data-ttu-id="eda78-313">有关要求提供客户端证书如何提高 Windows PowerShell Web 访问的安全性的详细信息，请参阅本指南中 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-313">For more information about how requiring client certificates can increase the security of Windows PowerShell Web Access, see [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md) in this guide.</span></span>

11. <span data-ttu-id="eda78-314">在客户端设备上打开浏览器会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-314">Open a browser session on a client device.</span></span> <span data-ttu-id="eda78-315">有关受支持的浏览器和设备的详细信息，请参阅本主题中的[浏览器和客户端设备支持](#browser-and-client-device-support)。</span><span class="sxs-lookup"><span data-stu-id="eda78-315">For more information about supported browsers and devices, see [Browser and client device support](#browser-and-client-device-support) in this topic.</span></span>

12. <span data-ttu-id="eda78-316">打开新的 Windows PowerShell Web 访问网站 https://\<gateway-server-name\>/pswa。</span><span class="sxs-lookup"><span data-stu-id="eda78-316">Open the new Windows PowerShell Web Access website, **https://\<*gateway-server-name*\>/pswa**.</span></span>

    <span data-ttu-id="eda78-317">浏览器应显示 Windows PowerShell Web 访问控制台登录页面。</span><span class="sxs-lookup"><span data-stu-id="eda78-317">The browser should display the Windows PowerShell Web Access console sign-in page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="eda78-318">你将无法登录，直到用户通过添加授权规则，获得访问该网站的权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-318">You cannot sign in until users have been granted access to the website by adding authorization rules.</span></span> <span data-ttu-id="eda78-319">有关详细信息，请参阅本部分中的[配置受限的授权规则](#configure-a-restrictive-authorization-rule)和 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-319">For more information, see [Configure a restrictive authorization rule](#configure-a-restrictive-authorization-rule), in this topic, and [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

13. <span data-ttu-id="eda78-320">在使用提升的用户权限打开的 Windows PowerShell 会话（以管理员身份运行）中，运行以下脚本（其中 *application_pool_name* 表示你在步骤 3 中创建的应用程序池的名称），以便向应用程序池提供授权文件的访问权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-320">In a Windows PowerShell session that has been opened with elevated user rights (Run as Administrator), run the following script, in which *application_pool_name* represents the name of the application pool that you created in step 3, to give the application pool access rights to the authorization file.</span></span>

    ```powershell
    $applicationPoolName = "<application_pool_name>"
    $authorizationFile = "C:\windows\web\powershellwebaccess\data\AuthorizationRules.xml"
    c:\windows\system32\icacls.exe $authorizationFile /grant ('"' + "IIS AppPool\$applicationPoolName" + '":R') > $null
    ```

    <span data-ttu-id="eda78-321">若要查看授权文件的现有访问权限，请运行以下命令：</span><span class="sxs-lookup"><span data-stu-id="eda78-321">To view existing access rights on the authorization file, run the following command:</span></span>

    ```powershell
    c:\windows\system32\icacls.exe $authorizationFile
    ```

#### <a name="to-use-iis-manager-to-configure-the-gateway-as-a-root-website-with-a-test-certificate"></a><span data-ttu-id="eda78-322">使用 IIS 管理器，将网关配置为带有测试证书的根网站</span><span class="sxs-lookup"><span data-stu-id="eda78-322">To use IIS Manager to configure the gateway as a root website with a test certificate</span></span>

1. <span data-ttu-id="eda78-323">通过执行以下操作之一，打开 IIS 管理器控制台。</span><span class="sxs-lookup"><span data-stu-id="eda78-323">Open the IIS Manager console by doing one of the following.</span></span>

   - <span data-ttu-id="eda78-324">在 Windows 桌面上，启动服务器管理器，方法是单击 Windows 任务栏中的“服务器管理器”  。</span><span class="sxs-lookup"><span data-stu-id="eda78-324">On the Windows desktop, start Server Manager by clicking **Server Manager** in the Windows taskbar.</span></span> <span data-ttu-id="eda78-325">在“服务器管理器”的**工具**菜单中，单击**Internet Information Services (IIS) Manager**。</span><span class="sxs-lookup"><span data-stu-id="eda78-325">On the **Tools** menu in Server Manager, click **Internet Information Services (IIS) Manager**.</span></span>
   - <span data-ttu-id="eda78-326">在 Windows“开始”  屏幕上，键入“Internet 信息服务 (IIS) 管理器”  名称的任何部分。</span><span class="sxs-lookup"><span data-stu-id="eda78-326">On the Windows **Start** screen, type any part of the name **Internet Information Services (IIS) Manager**.</span></span> <span data-ttu-id="eda78-327">当它在“应用程序”  结果中显示时，单击快捷方式。</span><span class="sxs-lookup"><span data-stu-id="eda78-327">Click the shortcut when it is displayed in the **Apps** results.</span></span>

1. <span data-ttu-id="eda78-328">在 IIS 管理器树窗格中，展开已安装 Windows PowerShell Web 访问的服务器的节点，直到“站点”  文件夹可见。</span><span class="sxs-lookup"><span data-stu-id="eda78-328">In the IIS Manager tree pane, expand the node for the server on which Windows PowerShell Web Access is installed until the **Sites** folder is visible.</span></span> <span data-ttu-id="eda78-329">选择“站点”  文件夹。</span><span class="sxs-lookup"><span data-stu-id="eda78-329">Select the **Sites** folder.</span></span>

1. <span data-ttu-id="eda78-330">在**操作**窗格中，单击**添加网站**。</span><span class="sxs-lookup"><span data-stu-id="eda78-330">In the **Actions** pane, click **Add Website**.</span></span>

1. <span data-ttu-id="eda78-331">键入网站的名称，例如**Windows PowerShell Web 访问**。</span><span class="sxs-lookup"><span data-stu-id="eda78-331">Type a name for the website, such as **Windows PowerShell Web Access**.</span></span>

1. <span data-ttu-id="eda78-332">新网站的应用程序池自动创建。</span><span class="sxs-lookup"><span data-stu-id="eda78-332">An application pool is automatically created for the new website.</span></span> <span data-ttu-id="eda78-333">若果使用其他应用程序池，请单击“选择”  ，以选择与新网站相关的应用程序池。</span><span class="sxs-lookup"><span data-stu-id="eda78-333">To use a different application pool, click **Select** to select an application pool to associate with the new website.</span></span> <span data-ttu-id="eda78-334">在**选择应用程序池**对话框中选择备用的应用程序池，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="eda78-334">Select the alternate application pool in the **Select Application Pool** dialog box, and then click **OK**.</span></span>

1. <span data-ttu-id="eda78-335">在“物理路径”  文本框中，导航到 %windir%/Web/PowerShellWebAccess/wwwroot。</span><span class="sxs-lookup"><span data-stu-id="eda78-335">In the **Physical path** text box, navigate to %windir%/Web/PowerShellWebAccess/wwwroot.</span></span>

1. <span data-ttu-id="eda78-336">在**绑定**区域的**类型**字段中，选择**https**。</span><span class="sxs-lookup"><span data-stu-id="eda78-336">In the **Type** field of the **Binding** area, select **https**.</span></span>

1. <span data-ttu-id="eda78-337">向网站分配一个不再被其他网站或应用程序使用的端口号。</span><span class="sxs-lookup"><span data-stu-id="eda78-337">Assign a port number to the website that is not already in use by another site or application.</span></span>
   <span data-ttu-id="eda78-338">若要定位打开的端口，你可在“命令提示符”窗口中运行 **netstat** 命令。</span><span class="sxs-lookup"><span data-stu-id="eda78-338">To locate open ports, you can run the **netstat** command in a Command Prompt window.</span></span> <span data-ttu-id="eda78-339">默认端口号为 443。</span><span class="sxs-lookup"><span data-stu-id="eda78-339">The default port number is 443.</span></span>

   <span data-ttu-id="eda78-340">如果其他网站已经使用 443，或你有其他更改端口号的安全原因，则更改默认端口。</span><span class="sxs-lookup"><span data-stu-id="eda78-340">Change the default port if another website is already using 443, or if you have other security reasons for changing the port number.</span></span> <span data-ttu-id="eda78-341">如果在你的网关服务器上运行的其他网站使用你所选的端口，当你在“添加网站”对话框中单击“确定”时，将会显示一条警告信息。</span><span class="sxs-lookup"><span data-stu-id="eda78-341">If another website that is running on your gateway server is using your selected port, a warning is displayed when you click **OK** in the **Add Website** dialog box.</span></span> <span data-ttu-id="eda78-342">必须使用未使用的端口运行 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-342">You must use an unused port to run Windows PowerShell Web Access.</span></span>

1. <span data-ttu-id="eda78-343">此外，如果你的组织有需要，请指定一个对组织和用户都有意义的主机名称，例如 **`www.contoso.com`** 。</span><span class="sxs-lookup"><span data-stu-id="eda78-343">Optionally, if needed for your organization, specify a host name that makes sense to your organization and users, such as **`www.contoso.com`**.</span></span> <span data-ttu-id="eda78-344">单击“确定”。 </span><span class="sxs-lookup"><span data-stu-id="eda78-344">Click **OK**.</span></span>

1. <span data-ttu-id="eda78-345">为提高生产环境的安全性，我们强烈建议提供证书颁发机构已签名的有效证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-345">For a more secure production environment, we strongly recommend providing a valid certificate that has been signed by a CA.</span></span> <span data-ttu-id="eda78-346">你必须提供 SSL 证书，因为用户仅可通过 HTTPS 网站连接到 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-346">You must provide an SSL certificate, because users can only connect to Windows PowerShell Web Access through an HTTPS website.</span></span> <span data-ttu-id="eda78-347">有关如何获得证书的详细信息，请参阅本主题中的[在 IIS 管理器中配置 SSL 证书](#to-configure-an-ssl-certificate-in-iis-manager)。</span><span class="sxs-lookup"><span data-stu-id="eda78-347">See [To configure an SSL certificate in IIS Manager](#to-configure-an-ssl-certificate-in-iis-manager) in this topic for more information about how to obtain a certificate.</span></span>

1. <span data-ttu-id="eda78-348">单击“确定”  关闭“添加网站”  对话框。</span><span class="sxs-lookup"><span data-stu-id="eda78-348">Click **OK** to close the **Add Website** dialog box.</span></span>

1. <span data-ttu-id="eda78-349">在使用提升的用户权限打开的 Windows PowerShell 会话（以管理员身份运行）中，运行以下脚本（其中 _application_pool_name_ 表示你在步骤 4 中创建的应用程序池的名称），以便向应用程序池提供授权文件的访问权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-349">In a Windows PowerShell session that has been opened with elevated user rights (Run as Administrator), run the following script, in which _application_pool_name_ represents the name of the application pool that you created in step 4, to give the application pool access rights to the authorization file.</span></span>

   ```powershell
   $applicationPoolName = "<application_pool_name>"
   $authorizationFile = "C:\windows\web\powershellwebaccess\data\AuthorizationRules.xml"
   c:\windows\system32\icacls.exe $authorizationFile /grant ('"' + "IIS AppPool\$applicationPoolName" + '":R') > $null
   ```

   <span data-ttu-id="eda78-350">若要查看授权文件的现有访问权限，请运行以下命令：</span><span class="sxs-lookup"><span data-stu-id="eda78-350">To view existing access rights on the authorization file, run the following command:</span></span>

   ```powershell
   c:\windows\system32\icacls.exe $authorizationFile
   ```

1. <span data-ttu-id="eda78-351">利用在 IIS 管理器树窗格中选择的新网站，单击“操作”窗格中的“启动”，以启动网站。</span><span class="sxs-lookup"><span data-stu-id="eda78-351">With the new website selected in the IIS Manager tree pane, click **Start** in the **Actions** pane to start the website.</span></span>

1. <span data-ttu-id="eda78-352">在客户端设备上打开浏览器会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-352">Open a browser session on a client device.</span></span> <span data-ttu-id="eda78-353">有关受支持的浏览器和设备的详细信息，请参阅本文档中的[浏览器和客户端设备支持](#browser-and-client-device-support)。</span><span class="sxs-lookup"><span data-stu-id="eda78-353">For more information about supported browsers and devices, see [Browser and client device support](#browser-and-client-device-support) in this document.</span></span>

1. <span data-ttu-id="eda78-354">打开新的 Windows PowerShell Web 访问网站。</span><span class="sxs-lookup"><span data-stu-id="eda78-354">Open the new Windows PowerShell Web Access website.</span></span>

   <span data-ttu-id="eda78-355">因为根网站指向 Windows PowerShell Web 访问文件夹，所以打开 `https://<gateway_server_name>` 时，浏览器应显示 Windows PowerShell Web 访问登录网页。</span><span class="sxs-lookup"><span data-stu-id="eda78-355">Because the root website points to the Windows PowerShell Web Access folder, the browser should display the Windows PowerShell Web Access sign-in page when you open `https://<gateway_server_name>`.</span></span> <span data-ttu-id="eda78-356">你无需向 URL 添加 **/pswa**。</span><span class="sxs-lookup"><span data-stu-id="eda78-356">You should not need to add **/pswa** to the URL.</span></span>

   > [!NOTE]
   > <span data-ttu-id="eda78-357">你将无法登录，直到用户通过添加授权规则，获得访问该网站的权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-357">You cannot sign in until users have been granted access to the website by adding authorization rules.</span></span> <span data-ttu-id="eda78-358">有关详细信息，请参阅本部分中的[配置受限的授权规则](#configure-a-restrictive-authorization-rule)和 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-358">For more information, see [Configure a restrictive authorization rule](#configure-a-restrictive-authorization-rule), in this topic, and [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

### <a name="configuring-a-restrictive-authorization-rule"></a><span data-ttu-id="eda78-359">配置受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-359">Configuring a restrictive authorization rule</span></span>

<span data-ttu-id="eda78-360">安装 Windows PowerShell Web 访问和配置网关后，用户可在浏览器中打开登录页面，但他们无法登录，直到 Windows PowerShell Web 访问管理员明确授予用户访问权限。</span><span class="sxs-lookup"><span data-stu-id="eda78-360">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="eda78-361">Windows PowerShell Web 访问的访问控制通过使用下表所述的 Windows PowerShell cmdlet 集进行管理。</span><span class="sxs-lookup"><span data-stu-id="eda78-361">Windows PowerShell Web Access access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="eda78-362">没有相当的 GUI 可用于添加或管理授权规则。</span><span class="sxs-lookup"><span data-stu-id="eda78-362">There is no comparable GUI for adding or managing authorization rules.</span></span> <span data-ttu-id="eda78-363">有关 Windows PowerShell Web 访问 cmdlet 的更多详细信息，请参阅 cmdlet 参考主题 [Windows PowerShell Web 访问 Cmdlet](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)。</span><span class="sxs-lookup"><span data-stu-id="eda78-363">For more detailed information about Windows PowerShell Web Access cmdlets, see the cmdlet reference topics, [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span></span>

<span data-ttu-id="eda78-364">有关 Windows PowerShell Web 访问授权规则和安全性的详细信息，请参阅 [Windows PowerShell Web 访问的授权规则和安全功能](authorization-rules-and-security-features-of-windows-powershell-web-access.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-364">For more detail about Windows PowerShell Web Access authorization rules and security, see [Authorization Rules and Security Features of Windows PowerShell Web Access](authorization-rules-and-security-features-of-windows-powershell-web-access.md).</span></span>

#### <a name="adding-a-restrictive-authorization-rule"></a><span data-ttu-id="eda78-365">添加受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="eda78-365">Adding a restrictive authorization rule</span></span>

1. <span data-ttu-id="eda78-366">使用提升的用户权限执行以下操作之一打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="eda78-366">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="eda78-367">在 Windows 桌面上，右键单击任务栏上的**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-367">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>
   - <span data-ttu-id="eda78-368">在 Windows **开始**屏幕上，右键单击**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="eda78-368">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

1. <span data-ttu-id="eda78-369">使用会话配置限制用户访问的可选步骤：</span><span class="sxs-lookup"><span data-stu-id="eda78-369">Optional step for restricting user access by using session configurations:</span></span>

   <span data-ttu-id="eda78-370">确保规则中已经存在要使用的会话配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-370">Verify that session configurations that you want to use in your rules already exist.</span></span> <span data-ttu-id="eda78-371">如果尚未创建这些配置，则使用 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configurations) 中用于创建会话配置的说明。</span><span class="sxs-lookup"><span data-stu-id="eda78-371">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configurations).</span></span>

1. <span data-ttu-id="eda78-372">键入以下命令，然后按**Enter**。</span><span class="sxs-lookup"><span data-stu-id="eda78-372">Type the following, and then press **Enter**.</span></span>

   `Add-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName <computer_name> -ConfigurationName <session_configuration_name>`

   <span data-ttu-id="eda78-373">本授权规则允许特定用户通过他们通常访问的网络访问一台计算机，以及可让特定用户拥有对满足用户常见脚本和 cmdlet 需求的特定会话配置的权限&trade;。</span><span class="sxs-lookup"><span data-stu-id="eda78-373">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user'&trade;s typical scripting and cmdlet needs.</span></span>

   <span data-ttu-id="eda78-374">在以下示例中，`Contoso` 域中名为 `JSmith` 的用户获得访问权限，以管理计算机 `Contoso_214`，并使用名为 `NewAdminsOnly` 的会话配置。</span><span class="sxs-lookup"><span data-stu-id="eda78-374">In the following example, a user named `JSmith` in the `Contoso` domain is granted access to manage the computer `Contoso_214`, and use a session configuration named `NewAdminsOnly`.</span></span>

   `Add-PswaAuthorizationRule -UserName 'Contoso\JSmith' -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly`

1. <span data-ttu-id="eda78-375">验证是否已通过运行 `Get-PswaAuthorizationRule` cmdlet 或 `Test-PswaAuthorizationRule -UserName '<domain\user>' -ComputerName <computer-name>` 创建了规则。</span><span class="sxs-lookup"><span data-stu-id="eda78-375">Verify that the rule has been created by running either the `Get-PswaAuthorizationRule` cmdlet, or `Test-PswaAuthorizationRule -UserName '<domain\user>' -ComputerName <computer-name>`.</span></span>

   <span data-ttu-id="eda78-376">例如，`Test-PswaAuthorizationRule -UserName 'Contoso\JSmith' -ComputerName Contoso_214` 。</span><span class="sxs-lookup"><span data-stu-id="eda78-376">For example, `Test-PswaAuthorizationRule -UserName 'Contoso\JSmith' -ComputerName Contoso_214`.</span></span>

   <span data-ttu-id="eda78-377">配置授权规则之后，授权用户便可以登录基于 Web 的控制台并开始使用 Windows PowerShell Web 访问。</span><span class="sxs-lookup"><span data-stu-id="eda78-377">After you have configured an authorization rule, you are ready for authorized users to sign in to the web-based console and begin using Windows PowerShell Web Access.</span></span>

## <a name="configure-a-genuine-certificate"></a><span data-ttu-id="eda78-378">配置正版证书</span><span class="sxs-lookup"><span data-stu-id="eda78-378">Configure a genuine certificate</span></span>

<span data-ttu-id="eda78-379">对于安全的生产环境，请始终使用证书颁发机构 (CA) 已签名的有效 SSL 证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-379">For a secure production environment, always use a valid SSL certificate that has been signed by a certification authority (CA).</span></span> <span data-ttu-id="eda78-380">本部分中的过程介绍如何从 CA 获取并应用有效的 SSL 证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-380">The procedure in this section describes how to obtain and apply a valid SSL certificate from a CA.</span></span>

### <a name="to-configure-an-ssl-certificate-in-iis-manager"></a><span data-ttu-id="eda78-381">在 IIS 管理器中配置 SSL 证书</span><span class="sxs-lookup"><span data-stu-id="eda78-381">To configure an SSL certificate in IIS Manager</span></span>

1. <span data-ttu-id="eda78-382">在 IIS 管理器树窗格中，选择已安装 Windows PowerShell Web 访问的服务器。</span><span class="sxs-lookup"><span data-stu-id="eda78-382">In the IIS Manager tree pane, select the server on which Windows PowerShell Web Access is installed.</span></span>

1. <span data-ttu-id="eda78-383">在内容窗格中，双击**服务器证书**。</span><span class="sxs-lookup"><span data-stu-id="eda78-383">In the content pane, double click **Server Certificates**.</span></span>

1. <span data-ttu-id="eda78-384">在“操作”  窗格中，执行以下操作之一。</span><span class="sxs-lookup"><span data-stu-id="eda78-384">In the **Actions** pane, do one of the following.</span></span> <span data-ttu-id="eda78-385">有关在 IIS 中配置服务器证书的详细信息，请参阅[在 IIS 7 中配置服务器证书](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732230(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="eda78-385">For more information about configuring server certificates in IIS, see [Configuring Server Certificates in IIS 7](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732230(v=ws.10)).</span></span>

   - <span data-ttu-id="eda78-386">单击“导入”  ，以从网络上的位置中导入现有的有效证书。</span><span class="sxs-lookup"><span data-stu-id="eda78-386">Click **Import** to import an existing, valid certificate from a location on your network.</span></span>
   - <span data-ttu-id="eda78-387">单击“创建证书请求”，以请求证书颁发机构颁发的证书，例如 [VeriSign](https://www.verisign.com/)、[Thawte](https://www.thawte.com/) 或 [GeoTrust](https://www.geotrust.com/)。</span><span class="sxs-lookup"><span data-stu-id="eda78-387">Click **Create Certificate Request** to request a certificate from a CA such as [VeriSign](https://www.verisign.com/), [Thawte](https://www.thawte.com/), or [GeoTrust](https://www.geotrust.com/).</span></span> <span data-ttu-id="eda78-388">证书的公用名必须与申请的主机头相匹配。</span><span class="sxs-lookup"><span data-stu-id="eda78-388">The certificate's common name must match the host header in the request.</span></span>

     <span data-ttu-id="eda78-389">例如，如果客户端浏览器申请 `http://www.contoso.com/`，则公用名也必须是 `http://www.contoso.com/`。</span><span class="sxs-lookup"><span data-stu-id="eda78-389">For example, if the client browser requests `http://www.contoso.com/`, then the common name must also be `http://www.contoso.com/`.</span></span> <span data-ttu-id="eda78-390">这是向 Windows PowerShell Web 访问网关提供证书的最安全的推荐方案。</span><span class="sxs-lookup"><span data-stu-id="eda78-390">This is the most secure and recommended option for providing the Windows PowerShell Web Access gateway with a certificate.</span></span>

   - <span data-ttu-id="eda78-391">单击“创建自签名的证书”  ，以创建你可立即使用的证书，必要时稍后再由 CA 签名。</span><span class="sxs-lookup"><span data-stu-id="eda78-391">Click **Create a Self-Signed Certificate** to create a certificate that you can use immediately, and have signed later by a CA if desired.</span></span> <span data-ttu-id="eda78-392">为自签名的证书指定一个友好名称，例如 **Windows PowerShell Web 访问**。</span><span class="sxs-lookup"><span data-stu-id="eda78-392">Specify a friendly name for the self-signed certificate, such as **Windows PowerShell Web Access**.</span></span> <span data-ttu-id="eda78-393">此选项被视为不安全的，仅建议在专用测试环境中使用。</span><span class="sxs-lookup"><span data-stu-id="eda78-393">This option is not considered secure, and is recommended only for a private test environment.</span></span>

1. <span data-ttu-id="eda78-394">创建或获得证书后，在 IIS 管理器树窗格中选择要应用证书的网站（如默认网站），然后单击“操作”窗格中的“绑定”。</span><span class="sxs-lookup"><span data-stu-id="eda78-394">After creating or obtaining a certificate, select the website to which the certificate is applied (for example, **Default Web Site**) in the IIS Manager tree pane, and then click **Bindings** in the **Actions** pane.</span></span>

1. <span data-ttu-id="eda78-395">如果尚未显示，则在“添加网站绑定”  对话框中，向网站添加 **https** 绑定。</span><span class="sxs-lookup"><span data-stu-id="eda78-395">In the **Add Site Binding** dialog box, add an **https** binding for the site, if one is not already displayed.</span></span> <span data-ttu-id="eda78-396">如果使用的不是自签名的证书，请从本程序的步骤 3 中指定主机名称。</span><span class="sxs-lookup"><span data-stu-id="eda78-396">If you are not using a self-signed certificate, specify the host name from step 3 of this procedure.</span></span> <span data-ttu-id="eda78-397">如果使用的是自签名的证书，则无需执行此步骤。</span><span class="sxs-lookup"><span data-stu-id="eda78-397">If you are using a self-signed certificate, this step is not required.</span></span>

1. <span data-ttu-id="eda78-398">选择要使用或在步骤 3 中创建的证书，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="eda78-398">Select the certificate that you obtained or created in step 3 of this procedure, and then click **OK**.</span></span>

## <a name="using-the-web-based-windows-powershell-console"></a><span data-ttu-id="eda78-399">使用基于 Web 的 Windows PowerShell 控制台</span><span class="sxs-lookup"><span data-stu-id="eda78-399">Using the web-based Windows PowerShell console</span></span>

<span data-ttu-id="eda78-400">安装 Windows PowerShell Web 访问以及按照本主题所述完成网关配置之后，基于 Web 的 Windows PowerShell 控制台随时可用。</span><span class="sxs-lookup"><span data-stu-id="eda78-400">After Windows PowerShell Web Access is installed and the gateway configuration is finished as described in this topic, the Windows PowerShell web-based console is ready to use.</span></span> <span data-ttu-id="eda78-401">有关基于 Web 的控制台的入门详细信息，请参阅[使用基于 Web 的 Windows PowerShell 控制台](use-the-web-based-windows-powershell-console.md)。</span><span class="sxs-lookup"><span data-stu-id="eda78-401">For more information about getting started in the web-based console, see [Use the Web-based Windows PowerShell Console](use-the-web-based-windows-powershell-console.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="eda78-402">另请参阅</span><span class="sxs-lookup"><span data-stu-id="eda78-402">See Also</span></span>

<span data-ttu-id="eda78-403">[Internet Information Services (IIS) 7.0 文档](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753433(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="eda78-403">[Internet Information Services (IIS) 7.0 Documentation](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753433(v=ws.10))</span></span>

<span data-ttu-id="eda78-404">[IIS Manager 7.0 帮助](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732664(v=ws.11))</span><span class="sxs-lookup"><span data-stu-id="eda78-404">[IIS Manager 7.0 Help](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732664(v=ws.11))</span></span>

<span data-ttu-id="eda78-405">[配置 Web 服务器安全 (IIS 7)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731278(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="eda78-405">[Configure Web Server Security (IIS 7)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731278(v=ws.10))</span></span>

<span data-ttu-id="eda78-406">[IPsec 部署资源](/previous-versions/windows/it-pro/windows-server-2003/cc776369(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="eda78-406">[IPsec Deployment Resources](/previous-versions/windows/it-pro/windows-server-2003/cc776369(v=ws.10))</span></span>
